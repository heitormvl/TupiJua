@model TupiJua.ViewModels.UserViewModel
@{
    ViewData["Title"] = "Meu Perfil";
    const int profileFieldTotal = 5;
    var profileFieldCompleted = 0;
    if (!string.IsNullOrWhiteSpace(Model.Username)) profileFieldCompleted++;
    if (!string.IsNullOrWhiteSpace(Model.Email)) profileFieldCompleted++;
    if (Model.Weight.HasValue) profileFieldCompleted++;
    if (Model.Height.HasValue) profileFieldCompleted++;
    if (Model.BirthDate.HasValue) profileFieldCompleted++;
    var profileProgressPercent = profileFieldCompleted * 20;
}

<div class="container-fluid min-vh-100 d-flex align-items-center justify-content-center py-4">
    <div class="row w-100 justify-content-center">
        <div class="col-12 col-md-10 col-lg-9 col-xl-8 col-xxl-7">
            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-body p-4 p-md-5">
                    @if (profileProgressPercent < 100)
                    {
                        <!-- Profile Completion Banner -->
                        <div class="profile-progress-card">
                            <div class="d-flex flex-column flex-sm-row align-items-center gap-3">
                                <div class="flex-fill">
                                    <p class="text-white fw-semibold mb-1">Complete seu perfil</p>
                                    <div class="progress profile-progress" role="progressbar" aria-label="Progresso do perfil">
                                        <div class="progress-bar" data-profile-progress="@profileProgressPercent" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: 0;"></div>
                                    </div>
                                    <div class="d-flex justify-content-between mt-2 text-white-50 small">
                                        <span>@profileFieldCompleted de @profileFieldTotal campos preenchidos</span>
                                        <span data-profile-progress-label>@profileProgressPercent%</span>
                                    </div>
                                </div>
                                <a asp-action="Edit" class="btn btn-sm btn-light rounded-pill shadow-sm d-flex align-items-center gap-1">
                                    <i class="fas fa-edit"></i>
                                    Atualizar perfil
                                </a>
                            </div>
                        </div>
                    }

                    <!-- Header -->
                    <div class="text-center mb-4">
                        <div class="mb-3">
                            <i class="fas fa-user-circle fa-3x text-primary"></i>
                        </div>
                        <h2 class="fw-bold mb-2">Meu Perfil</h2>
                        <p class="text-muted mb-0">Informações da sua conta</p>
                    </div>

                    <!-- Profile Info -->
                    <div class="profile-info">
                        <div class="row">
                            <!-- First Column -->
                            <div class="col-12 col-md-6">
                                <!-- Username -->
                                <div class="mb-4 profile-field">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="icon-wrapper me-3">
                                            <i class="fas fa-user text-primary"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <label class="form-label text-muted small mb-1">Nome de Usuário</label>
                                            <p class="mb-0 fw-semibold">@Model.Username</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Email -->
                                <div class="mb-4 profile-field">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="icon-wrapper me-3">
                                            <i class="fas fa-envelope text-primary"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <label class="form-label text-muted small mb-1">E-mail</label>
                                            <p class="mb-0 fw-semibold">@Model.Email</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Weight -->
                                <div class="mb-4 profile-field">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="icon-wrapper me-3">
                                            <i class="fas fa-weight text-primary"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <label class="form-label text-muted small mb-1">Peso</label>
                                            <p class="mb-0 fw-semibold">
                                                @if (Model.Weight.HasValue)
                                                {
                                                    @($"{Model.Weight:F1} kg")
                                                }
                                                else
                                                {
                                                    <span class="text-muted">Não informado</span>
                                                }
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Second Column -->
                            <div class="col-12 col-md-6">
                                <!-- Height -->
                                <div class="mb-4 profile-field">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="icon-wrapper me-3">
                                            <i class="fas fa-ruler-vertical text-primary"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <label class="form-label text-muted small mb-1">Altura</label>
                                            <p class="mb-0 fw-semibold">
                                                @if (Model.Height.HasValue)
                                                {
                                                    @($"{Model.Height:F2} m")
                                                }
                                                else
                                                {
                                                    <span class="text-muted">Não informado</span>
                                                }
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Birth Date -->
                                <div class="mb-4 profile-field">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="icon-wrapper me-3">
                                            <i class="fas fa-birthday-cake text-primary"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <label class="form-label text-muted small mb-1">Data de Nascimento</label>
                                            <p class="mb-0 fw-semibold">
                                                @if (Model.BirthDate.HasValue)
                                                {
                                                    @Model.BirthDate.Value.ToString("dd/MM/yyyy")
                                                }
                                                else
                                                {
                                                    <span class="text-muted">Não informado</span>
                                                }
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Theme Preference -->
                    <div class="theme-preference-card mb-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-3">
                                <div class="icon-wrapper">
                                    <i id="themeIconProfile" class="fas fa-circle-half-stroke text-primary"></i>
                                </div>
                                <div>
                                    <p class="fw-semibold mb-0">Aparência</p>
                                    <p class="text-muted small mb-0" id="themeLabel">Tema do sistema</p>
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <button type="button"
                                        class="theme-option-btn @(TupiJua.Helpers.ThemeHelper.GetThemeFromCookie(Context.Request) == "light" ? "active" : "")"
                                        data-theme-value="light"
                                        onclick="ThemeManager.applyTheme('light')"
                                        title="Claro" aria-label="Tema claro">
                                    <i class="fas fa-sun"></i>
                                </button>
                                <button type="button"
                                        class="theme-option-btn @(TupiJua.Helpers.ThemeHelper.GetThemeFromCookie(Context.Request) == "system" ? "active" : "")"
                                        data-theme-value="system"
                                        onclick="ThemeManager.applyTheme('system')"
                                        title="Sistema" aria-label="Tema do sistema">
                                    <i class="fas fa-circle-half-stroke"></i>
                                </button>
                                <button type="button"
                                        class="theme-option-btn @(TupiJua.Helpers.ThemeHelper.GetThemeFromCookie(Context.Request) == "dark" ? "active" : "")"
                                        data-theme-value="dark"
                                        onclick="ThemeManager.applyTheme('dark')"
                                        title="Escuro" aria-label="Tema escuro">
                                    <i class="fas fa-moon"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Edit Button -->
                    <div class="d-flex justify-content-center mb-3">
                        <a asp-action="Edit" class="btn btn-primary btn-lg rounded-3">
                            <i class="fas fa-edit me-2"></i>Editar Dados Pessoais
                        </a>
                    </div>

                    <!-- Back to Home Link -->
                    <div class="text-center">
                        <a asp-controller="Home" asp-action="Index" class="text-muted text-decoration-none">
                            <i class="fas fa-arrow-left me-1"></i>Voltar para o início
                        </a>
                    </div>

                    <!-- Logout Button -->
                    <div class="d-flex justify-content-center mt-4">
                        <form asp-controller="User" asp-action="Logout" method="post">
                            <button type="submit" class="btn btn-outline-danger rounded-pill">
                                <i class="fas fa-sign-out-alt me-2"></i>Encerrar Sessão
                            </button>
                        </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    (function () {
        const THEME_LABELS = {
            light:  'Tema claro',
            dark:   'Tema escuro',
            system: 'Tema do sistema'
        };
        const THEME_ICONS = {
            light:  'fa-sun',
            dark:   'fa-moon',
            system: 'fa-circle-half-stroke'
        };

        function syncProfileButtons(theme) {
            document.querySelectorAll('.theme-option-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.themeValue === theme);
            });

            const label = document.getElementById('themeLabel');
            if (label) label.textContent = THEME_LABELS[theme] ?? THEME_LABELS.system;

            const icon = document.getElementById('themeIconProfile');
            if (icon) icon.className = `fas ${THEME_ICONS[theme] ?? THEME_ICONS.system} text-primary`;
        }

        // Patch para notificar a página ao trocar o tema
        const _original = window.ThemeManager.applyTheme;
        window.ThemeManager.applyTheme = function (theme) {
            _original(theme);
            syncProfileButtons(theme);
        };

        document.addEventListener('DOMContentLoaded', () =>
            syncProfileButtons(ThemeManager.getCurrentTheme())
        );
    })();
</script>
}
